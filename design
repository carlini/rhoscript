---
Syntax
---

Blocks of code
    ({[<>]})


---
Semantics
---

Stack snapshots.
    At different points, a snapshot is taken of the stack.
    Registers A-B-C give the top three elements of the previous snapshot
    Registers D-E-F give the one before
    Snapshot can be restored to a specific state when commanded so

Block kinds:
    Imploding block takes argument, n, and implodes stak by N and THEN saves argument context.


---
Functions
---

int-and-add: string->int->int or string->string->int; cast both to int, add

group-together: list->list; [(a,b),(a,c),(b,d),(c,e),(c,f)]->[(a,(a,c)),(b,d),(c,(e,f))]

type-unaware-equals: Coerce as good as possible and comapre types.

halve: x -> x/2? double?

is-positive?

sort-by and arg-sort.

---
Automatic Compression
---

Missing open or close parens should be fixed automatically with the same one.

A function on the top of the stack at the end should be called with map.

Current: static binding of character -> [function], select by type
Better: Depending on types on stack, map character -> function.
    This saves space when only ~10 possible functions to call matching fun->fun->list.

Arithmetic encoding?

Type functions on the stack? Map and reduce could be on the same word.

It doesn't make sense to call "dup swap", or "* drop" where "*" freshly pushes a new value.


---
Code Compression
---

Checking "is high bit 1" isn't enough for compressed-mode.

Start block by encoding length of the block (in bits). Then, for each block,
encode the function:

1. Filter all available functions by those which match the types on the stack.
2. Weight each function by how valuable it is.
3. Compute, using the function weights, the arithmetic encoding of each.

It doesn't make sense to run some functions in non-stack-restoring mode (e.g., do-while, ite).

---
IO
---
Smart parsing and dumping:
 - The empty program must be the identity operator.

---
Random
---

When a function is not stack restoring, it should be forced right away. 
Otherwise, we won't know the right types. It'll also be very strange to ever want it delayed.